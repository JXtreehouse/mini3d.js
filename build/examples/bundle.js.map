{"version":3,"file":"bundle.js","sources":["../../examples/src/main.js"],"sourcesContent":["let VSHADER_SOURCE=`\n    attribute vec4 a_Position;\n    attribute vec4 a_Color;\n    attribute float a_Custom;    \n    uniform mat4 u_mvpMatrix;\n    varying vec4 v_Color;\n    void main(){\n        gl_Position = u_mvpMatrix * a_Position;\n        v_Color = a_Color;\n    }\n`;\n\nlet FSHADER_SOURCE=`\n    #ifdef GL_ES\n    precision mediump float;\n    #endif\n    varying vec4 v_Color;\n    void main(){\n        gl_FragColor = v_Color;\n    }\n`;\n\nfunction createMesh(){\n\n    let format = new mini3d.VertexFormat();\n    format.addAttrib(mini3d.VertexSemantic.POSITION, 3);\n    format.addAttrib(mini3d.VertexSemantic.COLOR, 3);\n\n    // cube\n    //       ^ Y\n    //       | \n    //       |\n    //       / -------> X \n    //      /\n    //     v\n    //    Z\n    //\n    //    v6----- v5\n    //   /|      /|\n    //  v1------v0|\n    //  | |     | |\n    //  | |v7---|-|v4\n    //  |/      |/\n    //  v2------v3\n\n    let mesh = new mini3d.Mesh(format);  \n    //6个面（12个三角形），24个顶点  \n    let position_data = [\n        //v0-v1-v2-v3 front (0,1,2,3)\n        1.0, 1.0, 1.0,  -1.0, 1.0, 1.0,  -1.0, -1.0, 1.0,  1.0, -1.0, 1.0,\n        //v0-v3-v4-v5 right (4,5,6,7)\n        1.0, 1.0, 1.0,  1.0, -1.0, 1.0,  1.0, -1.0, -1.0,  1.0, 1.0, -1.0,\n        //v0-v5-v6-v1 top (8,9,10,11)\n        1.0, 1.0, 1.0,  1.0, 1.0, -1.0,  -1.0, 1.0, -1.0, -1.0, 1.0, 1.0,\n        //v1-v6-v7-v2 left (12,13,14,15)\n        -1.0, 1.0, 1.0,  -1.0, 1.0, -1.0,  -1.0, -1.0, -1.0,  -1.0, -1.0, 1.0,\n        //v7-v4-v3-v2 bottom (16,17,18,19)\n        -1.0, -1.0, -1.0,  1.0, -1.0, -1.0,  1.0, -1.0, 1.0,  -1.0, -1.0, 1.0,\n        //v4-v7-v6-v5 back (20,21,22,23)\n        1.0, -1.0, -1.0,  -1.0, -1.0, -1.0,  -1.0, 1.0, -1.0,  1.0, 1.0, -1.0        \n    ];\n    let color_data = [\n        //v0-v1-v2-v3 front (blue)\n        0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\n        //v0-v3-v4-v5 right (green)\n        0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0,\n        //v0-v5-v6-v1 top (red)\n        1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0,\n        //v1-v6-v7-v2 left (yellow)\n        1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0,\n        //v7-v4-v3-v2 bottom (white)\n        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,\n        //v4-v7-v6-v5 back\n        0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0\n    ];\n\n    let triangels = [\n        0,1,2, 0,2,3,       //front\n        4,5,6, 4,6,7,       //right\n        8,9,10, 8,10,11,    //top\n        12,13,14, 12,14,15, //left\n        16,17,18, 16,18,19, //bottom\n        20,21,22, 20,22,23  //back\n    ]\n\n\n    mesh.setVertexData(mini3d.VertexSemantic.POSITION, position_data);    \n    mesh.setVertexData(mini3d.VertexSemantic.COLOR, color_data);   \n    mesh.setTriangles(triangels);\n    mesh.upload();            \n\n    return mesh;   \n}\n\nlet modelMatrix = new mini3d.Matrix4();\nlet viewProjMatrix = new mini3d.Matrix4();\nlet mvpMatrix = new mini3d.Matrix4();\nlet rotX = 0;\nlet rotY = 0;\n\nfunction example(){\n    let gl = mini3d.gl;\n\n    let shader = new mini3d.Shader();\n    if(!shader.create(VSHADER_SOURCE, FSHADER_SOURCE)){\n        console.log(\"Failed to initialize shaders\");\n        return;\n    }\n\n    shader.mapAttributeSemantic(mini3d.VertexSemantic.POSITION, 'a_Position');\n    shader.mapAttributeSemantic(mini3d.VertexSemantic.COLOR, 'a_Color');    \n\n    shader.use();    \n\n    let mesh = createMesh();     \n\n    let viewMatrix = new mini3d.Matrix4();\n    viewMatrix.setLookAt(.0, .0, 8.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0);\n    viewProjMatrix.setPerspective(30.0, mini3d.canvas.width/mini3d.canvas.height, 1.0, 100.0);\n    viewProjMatrix.multiply(viewMatrix);\n\n    setupInput(function(dx, dy){\n        rotX = Math.max(Math.min(rotX + dy, 90.0), -90.0);\n        //rotX += dy;\n        rotY += dx;\n        draw(mesh, shader);\n    })\n    \n\n    gl.clearColor(0, 0, 0, 1);\n    gl.clearDepth(1.0);\n    gl.enable(gl.DEPTH_TEST);\n\n    draw(mesh, shader);\n}\n\n\nfunction draw(mesh, shader){        \n    \n    modelMatrix.setRotate(rotX, 1, 0, 0); //rot around x-axis\n    modelMatrix.rotate(rotY, 0.0, 1.0, 0.0); //rot around y-axis\n\n    mvpMatrix.set(viewProjMatrix);\n    mvpMatrix.multiply(modelMatrix);\n    \n    shader.setUniform('u_mvpMatrix', mvpMatrix.elements);\n\n    let gl = mini3d.gl;\n    gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);\n    mesh.render(shader);\n}\n\nfunction setupInput(onDrag){\n    let dragging = false;\n    let lastX = -1, lastY = -1;\n\n    mini3d.canvas.onmousedown = function(event){        \n        let x = event.clientX;\n        let y = event.clientY;\n        let rect = event.target.getBoundingClientRect();\n        if(x>=rect.left && x<rect.right && y>=rect.top && y<rect.bottom){\n            lastX = x;\n            lastY = y;\n            dragging = true;\n        }\n    }\n\n    mini3d.canvas.onmouseup = function(event){\n        dragging = false;        \n    }\n\n    mini3d.canvas.onmousemove = function(event){        \n        let x = event.clientX;\n        let y = event.clientY;\n        if(dragging){\n            let factor = 300/mini3d.canvas.height;\n            let dx = factor * (x-lastX);\n            let dy = factor * (y-lastY);\n            if(onDrag){\n                onDrag(dx, dy);\n            }            \n        }\n        lastX = x;\n        lastY = y;\n    }\n}\n\nexport default function main(){    \n    example();\n}\n"],"names":["VSHADER_SOURCE","FSHADER_SOURCE","createMesh","format","mini3d","VertexFormat","addAttrib","VertexSemantic","POSITION","COLOR","mesh","Mesh","position_data","color_data","triangels","setVertexData","setTriangles","upload","modelMatrix","Matrix4","viewProjMatrix","mvpMatrix","rotX","rotY","example","gl","shader","Shader","create","console","log","mapAttributeSemantic","use","viewMatrix","setLookAt","setPerspective","canvas","width","height","multiply","setupInput","dx","dy","Math","max","min","draw","clearColor","clearDepth","enable","DEPTH_TEST","setRotate","rotate","set","setUniform","elements","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","render","onDrag","dragging","lastX","lastY","onmousedown","event","x","clientX","y","clientY","rect","target","getBoundingClientRect","left","right","top","bottom","onmouseup","onmousemove","factor","main"],"mappings":";;;IAAA,IAAIA,cAAc,uQAAlB;IAYA,IAAIC,cAAc,wJAAlB;;IAUA,SAASC,UAAT,GAAqB;IAEjB,MAAIC,MAAM,GAAG,IAAIC,MAAM,CAACC,YAAX,EAAb;IACAF,EAAAA,MAAM,CAACG,SAAP,CAAiBF,MAAM,CAACG,cAAP,CAAsBC,QAAvC,EAAiD,CAAjD;IACAL,EAAAA,MAAM,CAACG,SAAP,CAAiBF,MAAM,CAACG,cAAP,CAAsBE,KAAvC,EAA8C,CAA9C,EAJiB;IAOjB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA,MAAIC,IAAI,GAAG,IAAIN,MAAM,CAACO,IAAX,CAAgBR,MAAhB,CAAX,CAvBiB;;IAyBjB,MAAIS,aAAa,GAAG;IAEhB,KAFgB,EAEX,GAFW,EAEN,GAFM,EAEA,CAAC,GAFD,EAEM,GAFN,EAEW,GAFX,EAEiB,CAAC,GAFlB,EAEuB,CAAC,GAFxB,EAE6B,GAF7B,EAEmC,GAFnC,EAEwC,CAAC,GAFzC,EAE8C,GAF9C;IAIhB,KAJgB,EAIX,GAJW,EAIN,GAJM,EAIA,GAJA,EAIK,CAAC,GAJN,EAIW,GAJX,EAIiB,GAJjB,EAIsB,CAAC,GAJvB,EAI4B,CAAC,GAJ7B,EAImC,GAJnC,EAIwC,GAJxC,EAI6C,CAAC,GAJ9C;IAMhB,KANgB,EAMX,GANW,EAMN,GANM,EAMA,GANA,EAMK,GANL,EAMU,CAAC,GANX,EAMiB,CAAC,GANlB,EAMuB,GANvB,EAM4B,CAAC,GAN7B,EAMkC,CAAC,GANnC,EAMwC,GANxC,EAM6C,GAN7C;IAQhB,GAAC,GARe,EAQV,GARU,EAQL,GARK,EAQC,CAAC,GARF,EAQO,GARP,EAQY,CAAC,GARb,EAQmB,CAAC,GARpB,EAQyB,CAAC,GAR1B,EAQ+B,CAAC,GARhC,EAQsC,CAAC,GARvC,EAQ4C,CAAC,GAR7C,EAQkD,GARlD;IAUhB,GAAC,GAVe,EAUV,CAAC,GAVS,EAUJ,CAAC,GAVG,EAUG,GAVH,EAUQ,CAAC,GAVT,EAUc,CAAC,GAVf,EAUqB,GAVrB,EAU0B,CAAC,GAV3B,EAUgC,GAVhC,EAUsC,CAAC,GAVvC,EAU4C,CAAC,GAV7C,EAUkD,GAVlD;IAYhB,KAZgB,EAYX,CAAC,GAZU,EAYL,CAAC,GAZI,EAYE,CAAC,GAZH,EAYQ,CAAC,GAZT,EAYc,CAAC,GAZf,EAYqB,CAAC,GAZtB,EAY2B,GAZ3B,EAYgC,CAAC,GAZjC,EAYuC,GAZvC,EAY4C,GAZ5C,EAYiD,CAAC,GAZlD,CAApB;IAcA,MAAIC,UAAU,GAAG;IAEb,KAFa,EAER,GAFQ,EAEH,GAFG,EAEE,GAFF,EAEO,GAFP,EAEY,GAFZ,EAEiB,GAFjB,EAEsB,GAFtB,EAE2B,GAF3B,EAEgC,GAFhC,EAEqC,GAFrC,EAE0C,GAF1C;IAIb,KAJa,EAIR,GAJQ,EAIH,GAJG,EAIE,GAJF,EAIO,GAJP,EAIY,GAJZ,EAIiB,GAJjB,EAIsB,GAJtB,EAI2B,GAJ3B,EAIgC,GAJhC,EAIqC,GAJrC,EAI0C,GAJ1C;IAMb,KANa,EAMR,GANQ,EAMH,GANG,EAME,GANF,EAMO,GANP,EAMY,GANZ,EAMiB,GANjB,EAMsB,GANtB,EAM2B,GAN3B,EAMgC,GANhC,EAMqC,GANrC,EAM0C,GAN1C;IAQb,KARa,EAQR,GARQ,EAQH,GARG,EAQE,GARF,EAQO,GARP,EAQY,GARZ,EAQiB,GARjB,EAQsB,GARtB,EAQ2B,GAR3B,EAQgC,GARhC,EAQqC,GARrC,EAQ0C,GAR1C;IAUb,KAVa,EAUR,GAVQ,EAUH,GAVG,EAUE,GAVF,EAUO,GAVP,EAUY,GAVZ,EAUiB,GAVjB,EAUsB,GAVtB,EAU2B,GAV3B,EAUgC,GAVhC,EAUqC,GAVrC,EAU0C,GAV1C;IAYb,KAZa,EAYR,GAZQ,EAYH,GAZG,EAYE,GAZF,EAYO,GAZP,EAYY,GAZZ,EAYiB,GAZjB,EAYsB,GAZtB,EAY2B,GAZ3B,EAYgC,GAZhC,EAYqC,GAZrC,EAY0C,GAZ1C,CAAjB;IAeA,MAAIC,SAAS,GAAG,CACZ,CADY,EACV,CADU,EACR,CADQ,EACL,CADK,EACH,CADG,EACD,CADC;IAEZ,GAFY,EAEV,CAFU,EAER,CAFQ,EAEL,CAFK,EAEH,CAFG,EAED,CAFC;IAGZ,GAHY,EAGV,CAHU,EAGR,EAHQ,EAGJ,CAHI,EAGF,EAHE,EAGC,EAHD;IAIZ,IAJY,EAIT,EAJS,EAIN,EAJM,EAIF,EAJE,EAIC,EAJD,EAII,EAJJ;IAKZ,IALY,EAKT,EALS,EAKN,EALM,EAKF,EALE,EAKC,EALD,EAKI,EALJ;IAMZ,IANY,EAMT,EANS,EAMN,EANM,EAMF,EANE,EAMC,EAND,EAMI,EANJ;IAAA,GAAhB;IAUAJ,EAAAA,IAAI,CAACK,aAAL,CAAmBX,MAAM,CAACG,cAAP,CAAsBC,QAAzC,EAAmDI,aAAnD;IACAF,EAAAA,IAAI,CAACK,aAAL,CAAmBX,MAAM,CAACG,cAAP,CAAsBE,KAAzC,EAAgDI,UAAhD;IACAH,EAAAA,IAAI,CAACM,YAAL,CAAkBF,SAAlB;IACAJ,EAAAA,IAAI,CAACO,MAAL;IAEA,SAAOP,IAAP;IACH;;IAED,IAAIQ,WAAW,GAAG,IAAId,MAAM,CAACe,OAAX,EAAlB;IACA,IAAIC,cAAc,GAAG,IAAIhB,MAAM,CAACe,OAAX,EAArB;IACA,IAAIE,SAAS,GAAG,IAAIjB,MAAM,CAACe,OAAX,EAAhB;IACA,IAAIG,IAAI,GAAG,CAAX;IACA,IAAIC,IAAI,GAAG,CAAX;;IAEA,SAASC,OAAT,GAAkB;IACd,MAAIC,EAAE,GAAGrB,MAAM,CAACqB,EAAhB;IAEA,MAAIC,MAAM,GAAG,IAAItB,MAAM,CAACuB,MAAX,EAAb;;IACA,MAAG,CAACD,MAAM,CAACE,MAAP,CAAc5B,cAAd,EAA8BC,cAA9B,CAAJ,EAAkD;IAC9C4B,IAAAA,OAAO,CAACC,GAAR,CAAY,8BAAZ;IACA;IACH;;IAEDJ,EAAAA,MAAM,CAACK,oBAAP,CAA4B3B,MAAM,CAACG,cAAP,CAAsBC,QAAlD,EAA4D,YAA5D;IACAkB,EAAAA,MAAM,CAACK,oBAAP,CAA4B3B,MAAM,CAACG,cAAP,CAAsBE,KAAlD,EAAyD,SAAzD;IAEAiB,EAAAA,MAAM,CAACM,GAAP;IAEA,MAAItB,IAAI,GAAGR,UAAU,EAArB;IAEA,MAAI+B,UAAU,GAAG,IAAI7B,MAAM,CAACe,OAAX,EAAjB;IACAc,EAAAA,UAAU,CAACC,SAAX,CAAqB,EAArB,EAAyB,EAAzB,EAA6B,GAA7B,EAAkC,GAAlC,EAAuC,GAAvC,EAA4C,GAA5C,EAAiD,GAAjD,EAAsD,GAAtD,EAA2D,GAA3D;IACAd,EAAAA,cAAc,CAACe,cAAf,CAA8B,IAA9B,EAAoC/B,MAAM,CAACgC,MAAP,CAAcC,KAAd,GAAoBjC,MAAM,CAACgC,MAAP,CAAcE,MAAtE,EAA8E,GAA9E,EAAmF,KAAnF;IACAlB,EAAAA,cAAc,CAACmB,QAAf,CAAwBN,UAAxB;IAEAO,EAAAA,UAAU,CAAC,UAASC,EAAT,EAAaC,EAAb,EAAgB;IACvBpB,IAAAA,IAAI,GAAGqB,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,GAAL,CAASvB,IAAI,GAAGoB,EAAhB,EAAoB,IAApB,CAAT,EAAoC,CAAC,IAArC,CAAP,CADuB;;IAGvBnB,IAAAA,IAAI,IAAIkB,EAAR;IACAK,IAAAA,IAAI,CAACpC,IAAD,EAAOgB,MAAP,CAAJ;IACH,GALS,CAAV;IAQAD,EAAAA,EAAE,CAACsB,UAAH,CAAc,CAAd,EAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAvB;IACAtB,EAAAA,EAAE,CAACuB,UAAH,CAAc,GAAd;IACAvB,EAAAA,EAAE,CAACwB,MAAH,CAAUxB,EAAE,CAACyB,UAAb;IAEAJ,EAAAA,IAAI,CAACpC,IAAD,EAAOgB,MAAP,CAAJ;IACH;;IAGD,SAASoB,IAAT,CAAcpC,IAAd,EAAoBgB,MAApB,EAA2B;IAEvBR,EAAAA,WAAW,CAACiC,SAAZ,CAAsB7B,IAAtB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAFuB;;IAGvBJ,EAAAA,WAAW,CAACkC,MAAZ,CAAmB7B,IAAnB,EAAyB,GAAzB,EAA8B,GAA9B,EAAmC,GAAnC,EAHuB;;IAKvBF,EAAAA,SAAS,CAACgC,GAAV,CAAcjC,cAAd;IACAC,EAAAA,SAAS,CAACkB,QAAV,CAAmBrB,WAAnB;IAEAQ,EAAAA,MAAM,CAAC4B,UAAP,CAAkB,aAAlB,EAAiCjC,SAAS,CAACkC,QAA3C;IAEA,MAAI9B,EAAE,GAAGrB,MAAM,CAACqB,EAAhB;IACAA,EAAAA,EAAE,CAAC+B,KAAH,CAAS/B,EAAE,CAACgC,gBAAH,GAAoBhC,EAAE,CAACiC,gBAAhC;IACAhD,EAAAA,IAAI,CAACiD,MAAL,CAAYjC,MAAZ;IACH;;IAED,SAASc,UAAT,CAAoBoB,MAApB,EAA2B;IACvB,MAAIC,QAAQ,GAAG,KAAf;IACA,MAAIC,KAAK,GAAG,CAAC,CAAb;IAAA,MAAgBC,KAAK,GAAG,CAAC,CAAzB;;IAEA3D,EAAAA,MAAM,CAACgC,MAAP,CAAc4B,WAAd,GAA4B,UAASC,KAAT,EAAe;IACvC,QAAIC,CAAC,GAAGD,KAAK,CAACE,OAAd;IACA,QAAIC,CAAC,GAAGH,KAAK,CAACI,OAAd;IACA,QAAIC,IAAI,GAAGL,KAAK,CAACM,MAAN,CAAaC,qBAAb,EAAX;;IACA,QAAGN,CAAC,IAAEI,IAAI,CAACG,IAAR,IAAgBP,CAAC,GAACI,IAAI,CAACI,KAAvB,IAAgCN,CAAC,IAAEE,IAAI,CAACK,GAAxC,IAA+CP,CAAC,GAACE,IAAI,CAACM,MAAzD,EAAgE;IAC5Dd,MAAAA,KAAK,GAAGI,CAAR;IACAH,MAAAA,KAAK,GAAGK,CAAR;IACAP,MAAAA,QAAQ,GAAG,IAAX;IACH;IACJ,GATD;;IAWAzD,EAAAA,MAAM,CAACgC,MAAP,CAAcyC,SAAd,GAA0B,UAASZ,KAAT,EAAe;IACrCJ,IAAAA,QAAQ,GAAG,KAAX;IACH,GAFD;;IAIAzD,EAAAA,MAAM,CAACgC,MAAP,CAAc0C,WAAd,GAA4B,UAASb,KAAT,EAAe;IACvC,QAAIC,CAAC,GAAGD,KAAK,CAACE,OAAd;IACA,QAAIC,CAAC,GAAGH,KAAK,CAACI,OAAd;;IACA,QAAGR,QAAH,EAAY;IACR,UAAIkB,MAAM,GAAG,MAAI3E,MAAM,CAACgC,MAAP,CAAcE,MAA/B;IACA,UAAIG,EAAE,GAAGsC,MAAM,IAAIb,CAAC,GAACJ,KAAN,CAAf;IACA,UAAIpB,EAAE,GAAGqC,MAAM,IAAIX,CAAC,GAACL,KAAN,CAAf;;IACA,UAAGH,MAAH,EAAU;IACNA,QAAAA,MAAM,CAACnB,EAAD,EAAKC,EAAL,CAAN;IACH;IACJ;;IACDoB,IAAAA,KAAK,GAAGI,CAAR;IACAH,IAAAA,KAAK,GAAGK,CAAR;IACH,GAbD;IAcH;;AAED,IAAe,SAASY,IAAT,GAAe;IAC1BxD,EAAAA,OAAO;IACV;;;;;;;;"}